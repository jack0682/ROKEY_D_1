# 🧪 정밀 화합물 농도 제조 시스템 - 7일 완전 실행 마스터플랜
## **M0609 + 로드셀 하이브리드 정밀 농도 제조**

---

## 📂 **최종 디렉토리 구조**

```bash
/home/jaeho/project_ws/src/
├── doosan_m0609_control/                    # 기존 로봇 제어 (유지)
├── arduino_loadcell_interface/              # 아두이노 HX711 로드셀 통신
├── hybrid_weight_measurement/               # M0609 토크 + 로드셀 융합 측정
├── salt_concentration_calculator/           # 소금물 농도 계산 엔진
├── precision_liquid_pouring/                # 정밀 액체 주입 제어
├── chemistry_experiment_manager/            # 실험 시퀀스 총괄
├── safety_monitoring_system/                # 안전 감시 및 비상 대응
├── chemistry_msgs/                          # 커스텀 메시지/서비스 정의
└── experiment_data_logger/                  # 데이터 기록 및 성능 분석
```

---

## 🎯 **7일 절대 목표**

### **정량적 성능 목표**
- **농도 정확도**: ±0.05% (5% 목표 농도에서 4.95-5.05%)
- **반복 정밀도**: 20회 연속 제조 시 표준편차 ±0.03%
- **시스템 성공률**: 연속 50회 실험에서 95% 성공
- **실험 속도**: 단일 샘플 제조 평균 4분 이내

### **하드웨어 제약 조건**
- **센서**: M0609 내장 6축 토크센서 + 아두이노 HX711 로드셀만 사용
- **환경**: 실온 조건, 별도 환경 제어 없음
- **재료**: 일반 식염 + 증류수 + 표준 유리 비커
- **정밀도**: 로드셀 0.01g 분해능, 토크센서 0.2N 분해능

---

## ⏰ **7일 시간별 완전 실행 계획**

## 📅 **Day 1: 하드웨어 통합 및 기본 센서 시스템**

### **오전 (4시간): 아두이노 로드셀 시스템 구축**
**arduino_loadcell_interface 패키지 개발**
- HX711 + 5kg 로드셀 하드웨어 조립 및 배선
- 아두이노 펌웨어 개발: 80Hz 샘플링, Serial 통신
- ROS2 Serial 브릿지 노드 구현
- 기본 캘리브레이션 (1g, 10g, 100g 표준 분동)
- **목표**: 0.01g 분해능, 안정적 통신 달성

### **오후 (4시간): M0609 토크센서 정밀 캘리브레이션**
**hybrid_weight_measurement 패키지 기반 구축**
- 기존 doosan_m0609_control 토크 데이터 추출
- 6축 토크센서에서 Z축 중력 성분 분리
- 로봇 자세별 중력 보상 매트릭스 구성
- 토크-무게 변환 기본 모델 구현
- **목표**: 1g 이상 물체 감지 가능, 자세 보상 완료

## 📅 **Day 2: 센서 융합 및 정밀 무게 측정**

### **오전 (4시간): 하이브리드 센서 융합 시스템**
**융합 알고리즘 구현**
- Extended Kalman Filter 기반 센서 융합
- 상태 벡터: [무게, 무게변화율, 토크바이어스, 로드셀바이어스]
- 실시간 융합 필터 구현 (100Hz 업데이트)
- 센서 이상 감지 및 자동 전환 로직
- **목표**: 단일 센서 대비 50% 정밀도 향상

### **오후 (4시간): 정밀 무게 측정 최적화**
**측정 정확도 극대화**
- 다중 샘플링 전략 (빠른 측정 vs 정밀 측정)
- 통계적 이상치 제거 알고리즘
- 이동 평균 및 적응적 필터링
- 측정 불확실성 추정 및 신뢰도 계산
- **목표**: 0.005g 실효 분해능, CV < 1%

## 📅 **Day 3: 농도 계산 엔진 및 화학 모델링**

### **오전 (4시간): 소금물 농도 계산 시스템**
**salt_concentration_calculator 패키지 구현**
- 기본 w/w% 농도 계산 공식 구현
- 목표 농도 → 필요 재료량 역산 알고리즘
- 실측 무게 → 실제 농도 계산
- 오차 전파 분석 (가우시안 불확실성 전파)
- **목표**: 계산 정확도 99.95% 이상

### **오후 (4시간): 물리적 특성 모델링**
**실온 조건 소금물 특성 반영**
- 식염 밀도 (2.165 g/cm³) 및 용해도 특성
- 물 밀도 (0.998 g/cm³, 20°C 가정) 
- 혼합 시 부피 변화 보정 (약 0.5% 수축)
- 농도별 점성 변화 모델 (1-15% 범위)
- **목표**: 물리적 현실 99% 반영

## 📅 **Day 4: 정밀 액체 제어 시스템**

### **오전 (4시간): 기본 따르기 제어**
**precision_liquid_pouring 패키지 구현**
- 로봇 기본 모션 (파지, 이동, 기울이기)
- 실시간 무게 피드백 기반 주입 제어
- 2단계 제어: 고속 주입(85%) → 정밀 제어(15%)
- 기본 PID 제어기 구현 및 튜닝
- **목표**: ±0.5ml 기본 정확도

### **오후 (4시간): 고급 제어 알고리즘**
**정밀도 극한 추구**
- 액체 관성 및 지연 시간 보상
- 예측 제어 (유출 지연 0.5-1초 예측)
- 적응적 제어 게인 조정
- 오버슈트 방지 안전 마진 적용
- **목표**: ±0.1ml 정밀 제어

## 📅 **Day 5: 실험 자동화 및 시퀀스 관리**

### **오전 (4시간): 완전 자동화 워크플로**
**chemistry_experiment_manager 패키지 구현**
- 6단계 실험 시퀀스 자동화:
  1. 시스템 초기화 (30초)
  2. 소금 정밀 계량 (60초)  
  3. 필요 물량 계산 (5초)
  4. 물 정밀 주입 (90초)
  5. 혼합 및 교반 (30초)
  6. 농도 검증 및 기록 (15초)
- **목표**: 단일 실험 240초 이내

### **오후 (4시간): 배치 실험 시스템**
**다중 농도 연속 실험**
- 5개 농도 (1%, 3%, 5%, 10%, 15%) 연속 제조
- 실험간 용기 자동 교체 로직
- 누적 오차 방지 및 재캘리브레이션
- 실험 상태 모니터링 및 진행률 표시
- **목표**: 5개 농도 20분 이내 완료

## 📅 **Day 6: 안전 시스템 및 성능 최적화**

### **오전 (4시간): 포괄적 안전 시스템**
**safety_monitoring_system 패키지 구현**
- 물리적 안전: 로봇 충돌 감지, 과도한 힘 감지
- 액체 안전: 유출 감지, 용기 낙하 감지  
- 시스템 안전: 센서 오류, 통신 두절 감지
- 4단계 안전 레벨 (정상/주의/경고/비상)
- 비상 정지 및 안전 복구 프로토콜
- **목표**: 100ms 이내 이상 감지, 200ms 이내 비상 정지

### **오후 (4시간): 성능 최적화 및 파라미터 튜닝**
**시스템 전체 성능 향상**
- 센서 노이즈 특성 분석 및 필터 최적화
- 제어 파라미터 자동 튜닝 (Ziegler-Nichols 방법)
- 실험 조건별 최적 전략 도출
- 메모리 사용량 및 CPU 부하 최적화
- **목표**: 전체 성능 30% 향상

## 📅 **Day 7: 성능 검증 및 최종 테스트**

### **오전 (4시간): 정밀도 검증 실험**
**체계적 성능 평가**
- 각 농도별 정확도 테스트 (각 10회 반복)
- 반복 정밀도 테스트 (단일 농도 20회)
- 시스템 신뢰성 테스트 (50회 연속)
- 속도 성능 테스트 (시간 측정)
- **성공 기준**: 목표 정확도 달성, CV < 3%

### **오후 (4시간): 최종 통합 테스트 및 문서화**
**완전 자동화 검증**
- 5개 농도 자동 배치 실험 (각 3회)
- 무인 운영 안정성 확인
- 에러 복구 및 예외 상황 대응 테스트
- 사용자 매뉴얼 및 기술 문서 작성
- **최종 목표**: 97% 성공률, 완전 자동화 달성

---

## 📊 **상세 실험 프로토콜**

### **표준 실험 조건**
- **소스 용기**: 500ml 비커 (물 400ml 충전)
- **타겟 용기**: 100ml 비커 (빈 상태)
- **계량 도구**: 5ml 티스푼 (표준화)
- **작업 환경**: 실온 20±3°C, 진동 격리 테이블

### **좌표계 정의**
- **로봇 베이스**: (0, 0, 0)
- **로드셀 위치**: (250, 0, 150mm)  
- **소금통 위치**: (400, -100, 150mm)
- **물통 위치**: (400, 100, 150mm)
- **작업 대기 위치**: (0, 0, 400mm)

### **측정 정밀도 목표**
- **소금 계량**: ±0.01g (5g 기준 0.2% 오차)
- **물 주입**: ±0.05ml (50ml 기준 0.1% 오차)
- **농도 정확도**: ±0.05% (5% 농도 기준 1% 상대오차)

---

## 🔧 **핵심 기술적 도전과제**

### **1. 센서 융합 정밀도**
- **문제**: 토크센서와 로드셀의 서로 다른 특성
- **해결**: 상호 보완적 융합으로 각 센서 약점 극복
- **목표**: 융합 후 0.005g 실효 분해능

### **2. 액체 동역학 제어**
- **문제**: 액체 관성, 표면장력, 점성 효과
- **해결**: 물리 기반 모델 + 실시간 피드백 제어
- **목표**: 드립 현상까지 고려한 정밀 제어

### **3. 시스템 안정성**
- **문제**: 장시간 운영 시 드리프트 및 누적 오차
- **해결**: 실시간 캘리브레이션 + 적응적 보정
- **목표**: 8시간 연속 운영 성능 유지

### **4. 완전 자동화**
- **문제**: 다양한 예외 상황 대응
- **해결**: 포괄적 안전 시스템 + 지능적 복구
- **목표**: 무인 운영 95% 성공률

---

## 📈 **성능 검증 실험 설계**

### **Phase 1: 기본 정확도 검증**
- **농도별 테스트**: 1%, 3%, 5%, 10%, 15% 각 10회
- **측정 방법**: 기준 저울 + 전도도 측정
- **성공 기준**: ±0.05% 정확도, CV < 3%

### **Phase 2: 반복 정밀도 검증**  
- **단일 농도**: 5% 농도 30회 연속 제조
- **측정 항목**: 표준편차, 변동계수, 드리프트
- **성공 기준**: CV < 2%, 드리프트 < 0.01%/hour

### **Phase 3: 시스템 신뢰성 검증**
- **연속 운영**: 50회 연속 실험 (다양한 농도)
- **측정 항목**: 성공률, 에러 빈도, 복구 성능
- **성공 기준**: 95% 성공률, 자동 복구 90%

### **Phase 4: 최종 통합 검증**
- **배치 실험**: 5개 농도 자동 연속 제조
- **성능 지표**: 전체 소요시간, 누적 정확도
- **최종 목표**: 20분 이내, 전체 정확도 95%

---

## 🎯 **최종 성공 기준**

### **최소 성공 기준 (MVP)**
- 농도 정확도 ±0.1% 달성
- 20회 반복 실험 90% 성공
- 기본 안전 시스템 정상 작동

### **목표 성공 기준**
- 농도 정확도 ±0.05% 달성  
- 50회 연속 실험 95% 성공
- 완전 자동화 워크플로 구현

### **우수 성공 기준** 
- 농도 정확도 ±0.03% 달성
- 100회 연속 실험 97% 성공
- 산업용 수준 품질 관리 달성

---

## 📋 **현재 진행 상태 체크리스트**

### **Day 0: 준비 작업** ✅
- [x] 디렉토리 구조 재정립
- [x] 패키지 구조 정의
- [x] 기본 문서화 완료
- [x] 개발 도구 준비

### **Day 1: 하드웨어 기반** 🔄
- [ ] 아두이노 로드셀 하드웨어 조립
- [ ] arduino_loadcell_interface 패키지 구현
- [ ] M0609 토크센서 캘리브레이션
- [ ] 기본 통신 테스트

### **Day 2-7: 단계별 구현** ⏳
- [ ] 센서 융합 시스템
- [ ] 농도 계산 엔진
- [ ] 정밀 액체 제어
- [ ] 실험 자동화
- [ ] 안전 시스템
- [ ] 성능 최적화
- [ ] 최종 검증

---

이것이 **M0609와 로드셀만으로 ml급 정밀도를 달성하는 7일 완전 실행 마스터플랜**이다.